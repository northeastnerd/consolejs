var con=function(t,i,s,h,e,r,c,o){this.instance=con.instance++,this.linewidth=i,this.lines=s,this.cur_x=0,this.cur_y=0,this.x=0,this.y=0,this.canvas=document.createElement("canvas"),this.id=h,this.canvas.id=h+"_canvas",this.canvas.tabIndex="1",this.out=this.canvas.getContext("2d"),this.fgcol=void 0===r?"#00ff00":r,this.bgcol=void 0===c?"#000000":c,this.transparent=void 0!==o?o:0,this.font=void 0===e?"16px monospace":e,this.out.font=this.font,this.out.textAlign="left";var n="Hello";this.out.fillText(n,0,0);var d=this.out.measureText(n);this.inc_x=Math.round(d.width/5),this.inc_y=Math.round(2*this.inc_x),this.canvas.width=Math.floor(this.inc_x*(i+3)),this.canvas.height=this.inc_y*(s+1);var l=document.getElementById(t);for(null!=l?l.appendChild(this.canvas):document.body.appendChild(this.canvas),this.cls(),this.canvas.onkeydown=this.kbhit,this.canvas.parent=this,this.kbbfr=[],this.edbfr=[],this.last_edbfr=[],this.chbfr=[],n=0;n<=this.lines;n++)this.chbfr[n]=[];this.edit_x=0,this.edit_y=0,this.edit_idx=0,this.edit_cb=null,this.input_cb=null,this.cursor_enable=0,this.now=0;var u=this;this.timers=setInterval(function(){u.timer()},20),this.chcnt=0};con.instance=0,con.prototype.timer=function(){this.now++,this.blink_cursor(),50==this.now&&(this.now=0)},con.prototype.gotoxy=function(t,i){this.cur_x=t%this.linewidth,this.cur_y=i+parseInt(t/this.linewidth),this.check_scroll()},con.prototype.tab=function(t){if(!(t>this.linewidth)){var i,s=t-this.cur_x;for(this.cur_x>t&&(s+=this.linewidth),i=0;s<s;i++)this.putchar(" ")}},con.prototype.putchar=function(t){this.chcnt++,this.cursor(0),this.out.font=this.font,this.out.fillStyle=this.fgcol,"\r"==t||"\n"==t?(this.chbfr[this.cur_y][this.cur_x]=t,this.cur_x=0,this.cur_y++,this.check_scroll()):"\t"==t?this.tab(1):(void 0!==t&&(this.chbfr[this.cur_y][this.cur_x]=t,this.out.fillText(t,(this.cur_x+1)*this.inc_x,(this.cur_y+1)*this.inc_y)),this.cur_x++),this.cur_x>this.linewidth&&(this.cur_x=0,this.cur_y++,this.check_scroll())},con.prototype.check_scroll=function(){var t,i,s=this.lines;if(this.cur_y>=s){for(t=0;t<s-1;t++)this.chbfr[t]=this.chbfr[t+1];for(this.chbfr[s-1]=[],this.cls(),t=0;t<s-1;t++)for(i=0;i<this.chbfr[t].length;i++)this.putchar(this.chbfr[t][i])}},con.prototype.print=function(t){var i;if(void 0!==t)for(i=0;i<t.length;i++)this.putchar(t[i])},con.prototype.cls=function(){var t=this.out.fillStyle;this.out.fillStyle=this.bgcol,this.transparent?this.out.clearRect(0,0,this.canvas.width,this.canvas.height):this.out.fillRect(0,0,this.canvas.width,this.canvas.height),this.out.fillStyle=t,this.cur_x=0,this.cur_y=0,this.edit_x=0,this.edit_y=0},con.prototype.kbhit=function(t){t.preventDefault(),this.parent.kbbfr.push(t),null!=this.parent.edit_cb&&this.parent.editor()},con.prototype.editor=function(){var t,i,s,h;for(this.cursor(0),this.last_edbfr=this.edbfr,this.show_edits(0);this.kbbfr.length>0;){if(i=this.kbbfr[0].key,t=this.kbbfr[0].which,this.printable_key(t))this.edit_idx==this.edbfr.length?this.edbfr.push(i):(s=this.edbfr,this.edbfr=s.slice(0,this.edit_idx),this.edbfr=this.edbfr.concat(i),this.edbfr=this.edbfr.concat(s.slice(this.edit_idx))),this.edit_idx++;else if(8==t)this.edit_idx>0&&(s=this.edbfr,this.edbfr=s.slice(0,this.edit_idx-1),this.edbfr=this.edbfr.concat(s.slice(this.edit_idx)),this.edit_idx--);else if(9==t);else{if(13==t)return this.edit_cb=null,this.cursor_enable=0,this.show_edits(1),this.putchar("\n"),h=this.edbfr.join(""),isNaN(h)?this.input_cb(h):this.input_cb(parseFloat(h)),void this.kbbfr.shift();27==t?(this.edbfr=[],this.edit_idx=0):35==t?this.edit_idx=this.edbfr.length:36==t?this.edit_idx=0:37==t?this.edit_idx=this.edit_idx>0?this.edit_idx-1:0:39==t?this.edit_idx=this.edit_idx<this.edbfr.length?this.edit_idx+1:this.edbfr.length:45==t||46==t&&this.edit_idx<this.edbfr.length&&(s=this.edbfr,this.edbfr=s.slice(0,this.edit_idx),this.edbfr=this.edbfr.concat(s.slice(this.edit_idx+1)))}this.kbbfr.shift()}this.show_edits(1)},con.prototype.show_edits=function(t){var i;if(t)this.gotoxy(this.edit_x,this.edit_y),this.print(this.edbfr),this.gotoxy(this.edit_x+this.edit_idx,this.edit_y);else for(i=0;i<this.last_edbfr.length;i++)this.gotoxy(this.edit_x+i,this.edit_y),this.cursor(0)},con.prototype.cursor=function(t){var i,s=this.out.fillStyle;t?(this.out.fillStyle=this.fgcol,i=1):(this.out.fillStyle=this.bgcol,i=0);var h=(this.cur_x+1)*this.inc_x+i,e=this.cur_y*this.inc_y+this.inc_y/4+i;this.out.fillRect(h,e,this.inc_x-2*i,this.inc_y-2*i),this.out.fillStyle=s},con.prototype.blink_cursor=function(){25!=this.now&&this.cursor_enable||this.cursor(0),50==this.now&&this.cursor_enable&&this.cursor(1)},con.prototype.input=function(t){this.edit_x=this.cur_x,this.edit_y=this.cur_y,this.edit_idx=0,this.edbfr=[],this.last_edbfr=[],this.edit_cb=this.editor,this.input_cb=t,this.cursor_enable=1,this.cursor(1)},con.prototype.printable_key=function(t){return 8!=t&&13!=t&&16!=t&&17!=t&&18!=t&&20!=t&&27!=t&&33!=t&&34!=t&&35!=t&&36!=t&&37!=t&&38!=t&&39!=t&&40!=t&&46!=t&&144!=t&&(t<112||t>123)},con.prototype.codes_to_char=function(t){return this.non_mod_key(t.which)?String.fromCharCode(code):code};